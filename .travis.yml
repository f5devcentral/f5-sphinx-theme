sudo: required
services:
- docker
env:
  global:
  - USER_REPO=$(echo $TRAVIS_REPO_SLUG | cut -f -1 -d / )
  - PROJECT_UPLOAD_ROOT="tools/f5-sphinx-theme"
  - BUILD_UPLOAD_ROOT="${PROJECT_UPLOAD_ROOT}/${USER_REPO}/${TRAVIS_BRANCH}"
  - UPLOAD_DIR="${BUILD_UPLOAD_ROOT}/$(date +%F)-${TRAVIS_BUILD_NUMBER}"

language: python
python:
- '2.7'
before_install:
- git config --global user.email "OpenStack_TravisCI@f5.com"
- git config --global user.name "Travis F5"

install:
- npm install -g htmlhint
- npm install -g css-validator
- npm install -g broken-link-checker
- pip install -r requirements_test.txt
- pip install twine
script:
- css-validator f5_sphinx_theme/static/css/custom.css
- ./test/test-docs-docker.sh
# - htmlhint f5_sphinx_theme #issue 85
# - export PATH="$PATH:$(pwd)/node_modules/.bin"
# - webpack
# - cd test && make html

before_deploy:
  - echo "Deploying to ${S3_DIST_URL}/${UPLOAD_DIR}/"

deploy:
  - provider: script
    on:
      repo: f5devcentral/f5-sphinx-theme
      branch: master
      condition: "$TRAVIS_TAG =~ ^v[0-9]+\\.[0-9]+.*"
    script:
    - "./scripts/deploy.sh"
  # - provider: s3
  #   access_key_id: $AWS_ACCESS_KEY_ID
  #   secret_access_key: $AWS_SECRET_ACCESS_KEY
  #   bucket: $AWS_S3_BUCKET
  #   skip_cleanup: true
  #   local_dir: $TRAVIS_BUILD_DIR/test/docs/_build/html
  #   upload-dir: $UPLOAD_DIR
  #   on:
  #     all_branches: true
  #     tags: false
  # - provider: script
  #   script:
  #     - s3-index-generator -b $AWS_S3_BUCKET -t $BUILD_UPLOAD_ROOT
  #         -r ${PROJECT_UPLOAD_ROOT} -i 'index.html'
  #   on:
  #     all_branches: true
  #     tags: false

